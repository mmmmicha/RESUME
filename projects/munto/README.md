# 문토(MUNTO)

- link: https://www.munto.kr/

## 주요 프로젝트

### 스프레드 시트 데이터 갱신 자동화

- 소개: 특정 주기로 통계성 데이터를 스프레드 시트에 연동하는 데이터 갱신 자동화 시스템 입니다.
- 구성원: 1명
- 기간: 2024.08
- 역할
  - 전반적인 인프라 구축
    - serverless framework 부트스트래핑
    - serverless offline 테스트 환경 구축
    - lambda 배포 환경 구축
    - prisma 연동 환경 구축
    - google developers 연동 환경 구축
    - 구글 시트 연동 환경 구축
    - lambda vpc 연동 및 환경 변수 설정
  - 주기적으로 lambda에 요청을 보낼 수 있는 스케쥴러 기능 구현
  - 요구사항에 알맞는 쿼리를 조회할 수 있도록 내부 코드 구현

### 얼리버드

- 소개: 얼리버드 조건에 맞는 참여자에게 페이백 할인을 주는 시스템입니다.
- 구성원: 3명
- 기간: 2024.07
- 역할
  - 엔티티 구현
    - 얼리버드 할인
    - 할인 정책
    - 소셜링과 할인 협력 구현
    - 멤버와 할인 협력 구현
  - 기능 구현
    - 관련 기능들에 얼리버드 비즈니스 로직 추가
      - 소셜링 생성
      - 소셜링 수정
      - 소셜링 구매
      - 소셜링 구매 취소
      - 소셜링 내보내기
      - 스태프 선정/해제
  - ERD 설계
  - API 스펙 문서 작성

### 소셜링 생성/수정 v4->v5 버젼업 리팩터링

- 소개: service에 모든 비즈니스 코드들이 몰려있어 유지보수에 어려움이 있는 상황을 해결하기 위해 버젼업을 통한 전면적인 리팩터링을 실시했습니다.
- 구성원: 1명
- 기간: 2024.07
- 역할
  - **service 코드 책임 분리**
    - 영속화 데이터를 주고 받는 코드들은 전부 repository로 분리시켰습니다.
    - validation 중 유즈케이스와 관련되어 있는 코드는 service 레이어에 validator 클래스를 따로 만들고, 나머지 코어 validation 들은 전부 엔티티로 이동시켰습니다.
    - Controller 레이어에 엔티티 생성 책임을 이동시켰습니다.
    - request payload들을 직접 의존하던 service 코드들을 Controller에서 request payload를 기반으로 생성된 엔티티를 의존하도록 수정
  - **테스트 코드 소급 작성**
    - v5 버젼업 리팩터링 전 생성/수정 API에 대한 e2e 테스트를 작성했고, 리팩터링 환경을 최소한으로 마련했습니다.
    - 코드의 책임을 분리하면서 테스트코드 작성이 가능해진 부분들이 많이 생겼습니다. 특히 중요한 validation을 담당하는 코드들은 각각 validator와 entity에 테스트 코드를 전부 작성할 수 있었습니다.
  - **소셜링 생성 API의 Content-type 수정**
    - multipart/form-data -> application/json으로 수정
      - 파일처리에 대한 기능이 사라지면서 multipart/form-data의 필요성이 사라졌고 타입을 정확하게 다룰 수 있는 application/json의 필요성이 대두됐습니다. 이에 따라 request body 내에 class-validator와 class-transformer를 사용하여 모든 string 속성을 일일이 코어에서 사용하는 타입으로 파싱한 이후 validation을 했던 부분을 직접 타입에 맞게 validation 을 하도록 전면 수정하였습니다.
  - **엄격한 validation 룰 적용**
    - 소셜링 수정 API의 경우 request body 데이터에 관해 **undefined(무시)/null(제거)/값(수정)** 이라는 룰이 있는데 이를 통상 **IsOptional** 데코레이터를 통해 허용을 하고 있다보니 required필드들의 경우 null을 controller 레이어를 넘어 service 레이어에서 불필요하게 한번 더 검사를 하고 있었습니다. 이를 해결하기 위해 **IsUndefinable, IsNullable** 이라는 데코레이터를 생성하여 더 정교한 validation을 controller 레이어에서 처리할 수 있게 개선했습니다.
  - **트랜잭션 개선**
    - 생성과 수정의 경우 반드시 묶여야하는 영속화 로직들이 있는데 대부분의 코드들이 트랜잭션이 엮여있지 않아 평소 간헐적으로 데이터가 맞지 않는 문제들을 직접 해결하고 있었습니다. 이에 따라 트랜잭션을 걸어야하는 로직들에 트랜잭션을 추가했습니다.
  - **불필요한 v4 코드 deprecated 처리**
    - 이번에 v5로 대체된 코드 외에도 v4에 사용되지 않고 있는 코드들이 많이 있었습니다. 코드 히스토리를 파악할 때 늘 헷갈리게 만드는 주범들이었는데 전부 deprecated 시켰습니다.

### 엔티티 도입

- 소개: 절차지향 베이스의 프로젝트에서 일부 객체지향 요소를 도입했습니다.
- 구성원: 2명
- 기간: 2024.07
- 역할
  - 설계 참여
    - 주요 엔티티들에 대한 개념 재확립
    - 기존 코드들로 협력 관계 추출
  - 엔티티 구조도 제작 및 공유
  - 주요 엔티티 구현
    - 소셜링 엔티티 세부 구현
    - 태그 엔티티 구현
    - 소셜링 멤버 엔티티 세부 구현

### 기획전 리팩터링

- 소개: 확장성이 큰 기획전 기능을 담당하고 있는 레거시 코드를 유지보수가 용이하도록 리팩터링 했습니다.
- 구성원: 1명
- 기간: 2024.05
- 역할
  - 덩어리진 코드 분리 및 테스트 코드 전부 작성

## 기간별 프로젝트 진행 이력

24년 8월

- 기능구현
  - 스프레드 시트 데이터 갱신 자동화

24년 7월

- 기능구현
  - 얼리버드
  - 소셜링 수정 정책 강화
- 리팩터링
  - 소셜링 생성/수정 API v4->v5 버젼업 작업

24년 6월

- 기능구현
  - 호스트 임의 폐강 문제 해결
  - 내보내기 문제 해결
  - 신규 앵글 추가 및 상세 이미지 개선
  - 내보내기 멤버 상태 추가
  - 마이페이지 > 계정정보

24년 5월

- 기능구현
  - 문토Pick 상단고정 기능
  - 소셜링 성별 분리 모집
  - 소셜링 수정 정책 변경
- 리팩터링
  - 기획전 리팩터링

24년 4월

- 기능구현
  - 클래스 1:1 기능
    - 클래스 호스트 생성/삭제/조회
    - 어드민 클래스 호스트 관리 기능
  - 멀티 기획전

24년 3월

- 기능구현
  - 본인인증
  - 마이페이지 > 정산내역
  - 월별 정산 내역 이메일 전송 기능

24년 2월

- 기능구현
  - 마이페이지 > 결제내역
  - 첫 신청 혜택

24년 1월

- 기능구현
  - 플레이스
  - 클래스
  - 찜하기 후 추천 모달

23년 12월

- Docs
  - 온보딩 문서 작성
- 기능구현
  - 문지기 Pick

## 사용했던 기술

- `Language`: javascript, typescript, nodejs
- `Framework`: nestjs
- `ORM`: prisma
- `Database`: postgresql, mongoDB
- `Cache`: redis
- `CI/CD`: github Action
- `Infra`: aws
  - ec2, ecs, rds, elasticache, documentdb, vpc, parameter store, lambda, s3, cloudfront...
- `코드관리`: github
- `협업툴`: slack, notion, jira

## 배운점

### Git 관리

문토 백엔드 개발팀은 Squash merge, rebase, cherry-pick 등의 기능들을 적절히 활용하여 Git에 대한 컨벤션을 디테일하게 정해두고 관리를 했습니다. 합류 초기에 rebase를 사용한 development 및 production 브랜치 관리 방법을 습득하는 데 시간이 걸렸고, 몇 번의 실수도 겪었지만, 팀원들의 지원 덕분에 시행착오 끝에 Git 기능들을 능숙하게 다룰 수 있게 되었습니다.

### Redis 활용

팀에 합류하기 전에는 Redis를 단순 key-value 저장소로만 사용했지만, set과 zset을 이용한 고급 기능들을 익히면서 캐시 관리의 새로운 세계를 경험했습니다. 특히, intersect와 union을 통한 캐시 조합 방법은 강력했고, 다양한 검색 조건과 필터를 처리하는 데 중요한 역할을 했습니다. 이러한 세밀한 캐싱 전략을 통해 유저들에게 일관되게 빠른 속도의 데이터를 제공할 수 있었고, 앞으로 유사한 케이스에 이 방법들을 적용할 수 있을 것이라는 기대감을 갖게 되었습니다.
